<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VolunTree Notifications</title>
</head>
<body>
  <h2>Click to Subscribe to Notifications</h2>
  <button onclick="subscribeUser()">Enable Notifications</button>

  <script>
    // Convert base64 public key to Uint8Array
    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
      const rawData = window.atob(base64);
      return Uint8Array.from([...rawData].map(char => char.charCodeAt(0)));
    }

    async function subscribeUser() {
      if ('serviceWorker' in navigator && 'PushManager' in window) {
        try {
          const register = await navigator.serviceWorker.register('/worker.js', { scope: '/' });

          const subscription = await register.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: urlBase64ToUint8Array(
              'BLyDnKw4BmwfiALsZBnnKR6Gh29EfnbXZ5twBLLpLPhterJMLjKl0X2-r26b1uAmwKeY9KG6Lkx1Wd7iPgj5ID8'
            )
          });

        await fetch('http://localhost:4000/subscribe', {
  method: 'POST',
  body: JSON.stringify(subscription),
  headers: { 'Content-Type': 'application/json' }
});


          alert("✅ Subscribed to notifications!");
        } catch (error) {
          console.error("Subscription failed:", error);
          alert("❌ Subscription failed. Check console.");
        }
      } else {
        alert("Push notifications not supported in this browser.");
      }
    }
  </script>
</body>
</html>
